<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd">

    <changeSet id="create-table-templates" author="M_Zhivotovskiy">
        <sql>
            CREATE TABLE public.templates (
                                              id uuid NOT NULL,
                                              "name" varchar(255) NOT NULL,
                                              create_data timestamp NOT NULL,
                                              modify_data timestamp NOT NULL,
                                              organization_id int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE),
                                              "comment" text NULL,
                                              is_archive bool NOT NULL,
                                              template_element_id int8 NOT NULL,
                                              CONSTRAINT templates_name_key UNIQUE (name),
                                              CONSTRAINT templates_pkey PRIMARY KEY (id)
            );
        </sql>
    </changeSet>


    <changeSet  author="M_Zhivotovskiy"  id="dropTable-templates">
        <dropTable  cascadeConstraints="true"
                    catalogName="max"
                    schemaName="public"
                    tableName="templates"/>
    </changeSet>


    <changeSet id="create-table-templates_new" author="M_Zhivotovskiy">
        <createTable tableName="templates">
            <column name="id" type="uuid" remarks = "id templates" >
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)" >
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="create_data" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="modify_data" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="template_element_id" type="BIGSERIAL">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id" type="BIGSERIAL">
                <constraints nullable="false"/>
            </column>
            <column name="organization_ids" type="BIGSERIAL">
                <constraints nullable="false"/>
            </column>
            <column name="comment" type="TEXT"/>
            <column name="is_archive" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

<changeSet id="add-new-column-template_elements_id" author="M_Zhivotovskiy">
    <addForeignKeyConstraint
            baseTableName="templates"
            baseColumnNames="template_element_id"
            constraintName="FK_templates_template_element_id"
            referencedTableName="template_elements"
            referencedColumnNames="id"/>
</changeSet>


<!--<changeSet id="add-new-column-template_elements_id" author="M_Zhivotovskiy">-->
<!--    <addColumn tableName="templates">-->
<!--        <column name="template_element_id" type="BIGSERIAL">-->
<!--            <constraints foreignKeyName="FK_templates_template_element_id" references="template_elements(id)"-->
<!--                         nullable="false"/>-->
<!--        </column>-->
<!--    </addColumn>-->
<!--</changeSet>-->




</databaseChangeLog>